import os
import numpy as np
import pandas as pd
import covidfuncs.dffuncs as cvdff

ecdc_naming = {
    'IT': 'Italy',
    'ES': 'Spain',
    'FR': 'France',
    'DE': 'Germany',
    'United GB': 'Kingdom',
    'GB': 'United_Kingdom',
    'NL': 'Netherlands',
    'AT': 'Austria',
    'BE': 'Belgium',
    'NO': 'Norway',
    'SE': 'Sweden',
    'DK': 'Denmark',
    'PT': 'Portugal',
    'Czech CZ': 'Republic',
    'CZ': 'Czech_Republic',
    'GR': 'Greece',
    'FI': 'Finland',
    'IE': 'Ireland',
    'PL': 'Poland',
    'SI': 'Slovenia',
    'RO': 'Romania',
    'EE': 'Estonia',
    'IS': 'Iceland',
    'LU': 'Luxembourg',
    'SK': 'Slovakia',
    'BG': 'Bulgaria',
    'HR': 'Croatia',
    'HU': 'Hungary',
    'LV': 'Latvia',
    'CY': 'Cyprus',
    'MT': 'Malta',
    'LT': 'Lithuania',
    'LI': 'Liechtenstein',
    'sum': 'Europe'
}

# covid-19-eu-data
coviddata_eudata_de = pd.read_csv(
    os.environ['HOME'] + "/covid19/covid19-eu-data/dataset/covid-19-de.csv",
    sep=',',
)

coviddata_eudata_fr = pd.read_csv(
    os.environ['HOME'] + "/covid19/covid19-eu-data/dataset/covid-19-fr.csv",
    sep=',',
)

coviddata_eudata_ecdc = pd.read_csv(
    os.environ['HOME'] + "/covid19/covid19-eu-data/dataset/covid-19-ecdc.csv",
    sep=',',
)


def coviddata_eudata_germany():
    """
    Dataframe with columns for countries and regions and date=-index input from eudata repository data
    """
    # Drop unneeded
    coviddata_eudata_full = coviddata_eudata_de.drop(
        ["country", "cases/100k pop."], axis=1)

    # Rename
    coviddata_eudata_full = coviddata_eudata_full.rename(
        {
            "cases": "Confirmed",
            "deaths": "Deaths"
        }, axis=1)

    # First try
    coviddata_eudata = coviddata_eudata_full[coviddata_eudata_full["state"] ==
                                             "sum"]
    coviddata_eudata = coviddata_eudata.rename(
        {
            "Confirmed": "Germany",
            "Deaths": "Germany-Deaths"
        }, axis=1)
    coviddata_eudata = coviddata_eudata.drop(["state"], axis=1)
    coviddata_eudata.index = pd.to_datetime(coviddata_eudata["datetime"])
    coviddata_eudata = coviddata_eudata.drop("datetime", axis=1)

    # List of Bundesl√§nder
    bundeslaender = np.array(coviddata_eudata_full["state"][-17:-1])

    for land in bundeslaender:
        coviddata_eudata_land = coviddata_eudata_full[
            coviddata_eudata_full["state"] == land]
        coviddata_eudata_land = coviddata_eudata_land.rename(
            {
                "Confirmed": land,
                "Deaths": land + "-Deaths"
            }, axis=1)
        coviddata_eudata_land = coviddata_eudata_land.drop(["state"], axis=1)
        coviddata_eudata_land.index = pd.to_datetime(
            coviddata_eudata_land["datetime"])
        coviddata_eudata_land = coviddata_eudata_land.drop("datetime", axis=1)

        coviddata_eudata[land] = coviddata_eudata_land[land]
        coviddata_eudata[land + "-Deaths"] = coviddata_eudata_land[land +
                                                                   "-Deaths"]

    return coviddata_eudata


def coviddata_eudata_france():
    """
    Dataframe with columns for countries and regions and date=-index input from eudata repository data
    """
    # Drop unneeded
    coviddata_eudata_full = coviddata_eudata_fr.drop(["country"], axis=1)

    # Rename
    coviddata_eudata_full = coviddata_eudata_full.rename(
        {"cases": "Confirmed"}, axis=1)

    # First try
    coviddata_eudata = coviddata_eudata_full[coviddata_eudata_full["authority"]
                                             == "sum"]
    coviddata_eudata = coviddata_eudata.rename({"Confirmed": "France"}, axis=1)
    coviddata_eudata = coviddata_eudata.drop(["authority"], axis=1)
    coviddata_eudata.index = pd.to_datetime(coviddata_eudata["datetime"])
    coviddata_eudata = coviddata_eudata.drop("datetime", axis=1)

    # List of districts
    districts = np.array(coviddata_eudata_full["authority"][-23:-1])

    for land in districts:
        coviddata_eudata_land = coviddata_eudata_full[
            coviddata_eudata_full["authority"] == land]
        coviddata_eudata_land = coviddata_eudata_land.rename(
            {"Confirmed": land}, axis=1)
        coviddata_eudata_land = coviddata_eudata_land.drop(["authority"],
                                                           axis=1)
        coviddata_eudata_land.index = pd.to_datetime(
            coviddata_eudata_land["datetime"])
        coviddata_eudata_land = coviddata_eudata_land.drop("datetime", axis=1)

        coviddata_eudata[land] = coviddata_eudata_land[land]

    return coviddata_eudata


def coviddata_eudata_europe():
    """
    Dataframe with columns for countries and regions and date=-index input from eudata repository data
    """
    # Take input
    coviddata_eudata_full = coviddata_eudata_ecdc

    # Rename
    coviddata_eudata_full = coviddata_eudata_full.rename(
        {
            "cases": "Confirmed",
            "deaths": "Deaths"
        }, axis=1)

    # First try
    coviddata_eudata = coviddata_eudata_full[coviddata_eudata_full["country"]
                                             == "sum"]
    coviddata_eudata = coviddata_eudata.rename(
        {
            "Confirmed": ecdc_naming["sum"],
            "Deaths": ecdc_naming["sum"] + "-Deaths"
        },
        axis=1)
    coviddata_eudata = coviddata_eudata.drop(["country"], axis=1)
    coviddata_eudata.index = pd.to_datetime(coviddata_eudata["datetime"])
    coviddata_eudata = coviddata_eudata.drop("datetime", axis=1)

    # List of EU-countries
    eu_countries = np.array(coviddata_eudata_full["country"][-17:-1])

    for land in eu_countries:
        coviddata_eudata_land = coviddata_eudata_full[
            coviddata_eudata_full["country"] == land]
        coviddata_eudata_land = coviddata_eudata_land.rename(
            {
                "Confirmed": ecdc_naming[land],
                "Deaths": ecdc_naming[land] + "-Deaths"
            },
            axis=1)
        coviddata_eudata_land = coviddata_eudata_land.drop(["country"], axis=1)
        coviddata_eudata_land.index = pd.to_datetime(
            coviddata_eudata_land["datetime"])
        coviddata_eudata_land = coviddata_eudata_land.drop("datetime", axis=1)

        coviddata_eudata[ecdc_naming[land]] = coviddata_eudata_land[
            ecdc_naming[land]]
        coviddata_eudata[ecdc_naming[land] +
                         "-Deaths"] = coviddata_eudata_land[ecdc_naming[land] +
                                                            "-Deaths"]

    return coviddata_eudata
