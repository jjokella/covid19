import os
import numpy as np
import pandas as pd
import covidfuncs.dffuncs as cvdff

# WHO data from git-repository
coviddata_who_all = pd.read_csv(
    os.environ['HOME'] +
    "/covid19/COVID-19/who_covid_19_situation_reports/who_covid_19_sit_rep_time_series/who_covid_19_sit_rep_time_series.csv",
    sep=',',
)


def coviddata_who(countries):
    """
    Dataframe with columns countries and date=-index input from WHO data
    """

    # Drop non-dates
    coviddata_who = coviddata_who_all.drop(
        ["Province/States", "Country/Region", "WHO region"], axis=1)

    # Drop unnamed
    coviddata_who = coviddata_who.drop(
        coviddata_who.columns[
            coviddata_who.columns.str.contains("^Unnamed")],
        axis=1)

    # Transpose
    coviddata_who = coviddata_who.T

    # Index to datetime
    coviddata_who.index = pd.to_datetime(
        coviddata_who.index)

    # Column names to countrynames
    coviddata_who.columns = coviddata_who_all["Country/Region"]

    # Countries
    coviddata_who = coviddata_who[countries]

    if "China" in countries:
        covid_france = coviddata_who["China"].sum(axis="columns")
        coviddata_who = coviddata_who.drop("China",
                                                               axis="columns")
        coviddata_who["China"] = covid_france

    return coviddata_who
