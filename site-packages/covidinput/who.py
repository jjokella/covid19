import os
import numpy as np
import pandas as pd
# import covidfuncs.dffuncs as cvdff

# WHO data from git-repository
coviddata_who_all = pd.read_csv(
    os.environ['HOME'] +
    "/covid19/data/COVID-19/who_covid_19_situation_reports/who_covid_19_sit_rep_time_series/who_covid_19_sit_rep_time_series.csv",
    sep=',',
)

who_naming = {
    'Italy': 'Italy',
    'Spain': 'Spain',
    'France': 'France',
    'Germany': 'Germany',
    # 'United GB': 'Kingdom',
    # 'GB': 'United_Kingdom',
    'Netherlands': 'Netherlands',
    'Austria': 'Austria',
    'Belgium': 'Belgium',
    'Norway': 'Norway',
    'Sweden': 'Sweden',
    'Denmark': 'Denmark',
    'Portugal': 'Portugal',
    'Greece': 'Greece',
    # 'FI': 'Finland',
    # 'IE': 'Ireland',
    # 'PL': 'Poland',
    # 'SI': 'Slovenia',
    # 'RO': 'Romania',
    # 'EE': 'Estonia',
    # 'IS': 'Iceland',
    # 'LU': 'Luxembourg',
    # 'SK': 'Slovakia',
    # 'BG': 'Bulgaria',
    # 'HR': 'Croatia',
    # 'HU': 'Hungary',
    # 'LV': 'Latvia',
    # 'CY': 'Cyprus',
    # 'MT': 'Malta',
    # 'LT': 'Lithuania',
    # 'LI': 'Liechtenstein',
    'US': 'United States of America',
    'Korea, South': 'Republic of Korea',
    'Mexico': 'Mexico',
}


def coviddata_who(countries):
    """
    Dataframe with columns countries and date=-index input from WHO data
    """

    # Change countries
    countries_who = [who_naming[country] for country in countries]

    # Drop non-dates
    coviddata_who = coviddata_who_all.drop(
        ["Province/States", "Country/Region", "WHO region"], axis=1)

    # Drop unnamed
    coviddata_who = coviddata_who.drop(
        coviddata_who.columns[coviddata_who.columns.str.contains("^Unnamed")],
        axis=1)

    # Transpose
    coviddata_who = coviddata_who.T

    # Index to datetime
    coviddata_who.index = [
        pd.to_datetime(datstr.replace("19-Apr", "2020/04/19"), utc=True)
        for datstr in coviddata_who.index
    ]

    # Column names to countrynames
    coviddata_who.columns = coviddata_who_all["Country/Region"]

    # Countries
    coviddata_who = coviddata_who[countries_who]

    if "United States of America" in countries:
        covid_france = coviddata_who["United States of America"].sum(
            axis="columns")
        coviddata_who = coviddata_who.drop("United States of America",
                                           axis="columns")
        coviddata_who["United States of America"] = covid_france
    if "China" in countries:
        covid_france = coviddata_who["China"].sum(axis="columns")
        coviddata_who = coviddata_who.drop("China", axis="columns")
        coviddata_who["China"] = covid_france
    if "Netherlands" in countries:
        covid_france = coviddata_who["Netherlands"].sum(axis="columns")
        coviddata_who = coviddata_who.drop("Netherlands", axis="columns")
        coviddata_who["Netherlands"] = covid_france
    if "United Kingdom" in countries:
        covid_france = coviddata_who["United Kingdom"].sum(axis="columns")
        coviddata_who = coviddata_who.drop("United Kingdom", axis="columns")
        coviddata_who["United Kingdom"] = covid_france

    for country in countries:
        # Change name and turn to np.float64
        coviddata_who[country] = coviddata_who[who_naming[country]].apply(
            np.float64)

    return coviddata_who
