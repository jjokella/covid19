import numpy as np
import pandas as pd
import covidfuncs.dffuncs as cvdff

# CSSE John Hopkins University, git-repository
coviddata_csse_all = pd.read_csv(
    "/home/jke/covid19/COVID-19/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv",
    sep=',',
)


def coviddata_csse_countries(countries):
    """
    Dataframe with columns countries and date=-index input from CSSE data
    """

    # Drop non-dates
    coviddata_csse_countries = coviddata_csse_all.drop(
        ["Province/State", "Country/Region", "Lat", "Long"], axis=1)

    # Transpose
    coviddata_csse_countries = coviddata_csse_countries.T

    # Index to datetime
    coviddata_csse_countries.index = pd.to_datetime(coviddata_csse_countries.index)

    # Column names to countrynames
    coviddata_csse_countries.columns = coviddata_csse_all["Country/Region"]

    # Countries
    coviddata_csse_countries = coviddata_csse_countries[countries]

    if "France" in countries:
        covid_france = coviddata_csse_countries["France"].sum(axis="columns")
        coviddata_csse_countries = coviddata_csse_countries.drop("France", axis="columns")
        coviddata_csse_countries["France"] = covid_france
    if "US" in countries:
        covid_france = coviddata_csse_countries["US"].sum(axis="columns")
        coviddata_csse_countries = coviddata_csse_countries.drop("US", axis="columns")
        coviddata_csse_countries["US"] = covid_france
    if "China" in countries:
        covid_france = coviddata_csse_countries["China"].sum(axis="columns")
        coviddata_csse_countries = coviddata_csse_countries.drop("China", axis="columns")
        coviddata_csse_countries["China"] = covid_france
    
    return coviddata_csse_countries


def coviddata_csse(n_country, is_add_log=False, is_add_growth_factor=False):
    """
    Reading country input from CSSE data
    """

    coviddata_csse = pd.DataFrame(
        [
            coviddata_csse_all[col][n_country]
            for col in coviddata_csse_all.columns[4:]
        ],
        index=[
            pd.Timestamp(colname) for colname in coviddata_csse_all.columns[4:]
        ],
        columns=["Confirmed"],
    )
    coviddata_csse.name = ("CSSE-JHU " + covid_country(n_country))

    if is_add_log:
        coviddata_csse = cvdff.add_log(coviddata_csse, "Confirmed")

    if is_add_growth_factor:
        coviddata_csse = cvdff.add_growth_factor(coviddata_csse, "Confirmed")

    return coviddata_csse


def covid_country(n_country):
    """
    Reading country input from CSSE data
    """

    return coviddata_csse_all["Country/Region"][n_country]
